package dev.starstruck.module.exploit;

import dev.starstruck.listener.bus.Listener;
import dev.starstruck.listener.event.network.EventPacket;
import dev.starstruck.module.Module;
import dev.starstruck.module.ModuleCategory;
import dev.starstruck.setting.Setting;
import net.minecraft.network.play.client.CPacketChatMessage;

import java.nio.charset.StandardCharsets;

/**
 * @author aesthetical
 * @since 06/09/23
 */
public class AntiPopLag extends Module {
    private final Setting<Integer> size = new Setting<>(
            250, 0, 1000, "Size");

    public AntiPopLag() {
        super("AntiPopLag",
                "Stops retards from lagging you out",
                ModuleCategory.EXPLOIT);
    }

    @Listener
    public void onPacketIn(EventPacket.In event) {
        if (event.getPacket() instanceof CPacketChatMessage) {
            CPacketChatMessage packet = event.getPacket();
            byte[] bytes = packet.getMessage().getBytes(StandardCharsets.UTF_8);
            if (bytes.length >= size.getValue()) {
                event.cancel();
                print("Canceled message from the server with a byte size of " + bytes.length + "b");
            }
        }
    }
}
