package dev.starstruck.module.exploit;

import dev.starstruck.listener.bus.Listener;
import dev.starstruck.listener.event.network.EventPacket;
import dev.starstruck.mixin.mixins.network.packet.server.ISPacketPlayerPosLook;
import dev.starstruck.module.Module;
import dev.starstruck.module.ModuleCategory;
import net.minecraft.network.play.server.SPacketPlayerPosLook;
import net.minecraft.network.play.server.SPacketPlayerPosLook.EnumFlags;

/**
 * @author aesthetical
 * @since 06/10/23
 */
public class NoRotateSet extends Module {
    public NoRotateSet() {
        super("NoRotateSet",
                "Stops the server from rotating you",
                ModuleCategory.EXPLOIT);
    }

    @Listener
    public void onPacketIn(EventPacket.In event) {
        if (event.getPacket() instanceof SPacketPlayerPosLook) {
            SPacketPlayerPosLook packet = event.getPacket();

            ((ISPacketPlayerPosLook) packet).setYaw(mc.player.rotationYaw);
            ((ISPacketPlayerPosLook) packet).setPitch(mc.player.rotationPitch);

            packet.getFlags().remove(EnumFlags.X_ROT);
            packet.getFlags().remove(EnumFlags.Y_ROT);
        }
    }
}
